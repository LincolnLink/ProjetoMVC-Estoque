<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>>COTI Informática</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />

    <!--JS-->
    <script src="~/Scripts/jquery-3.0.0.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script>
        //função inicial do jquery..
        //quando a página estiver pronta, faça..

        $(document).ready(function () {

            //imprimir mensagem no log do navegador..
            console.log('JQuery iniciado!');

            //função ajax para consultar os estoques..
            $.ajax({
                type: "POST",
                url: "/Estoque/ConsultarEstoque",
                data: {},
                success: function (lista) {
                    console.log("Dados: " + lista);
                    var conteudo = "<option value=''>Escolha uma Opção</option>";

                    for(var i = 0; i < lista.length; i++) {
                        conteudo += "<option value='" + lista[i].IdEstoque + "'>";
                        conteudo += lista[i].NomeEstoque;
                        conteudo += "</option>";
                    }

                    $("#estoque").html(conteudo);
                },
                error: function (e) {
                    console.log("Erro: " + e.status);
                }
            });

            //Criando um evento no botão de cadastro..
            $("#btncadastro").click(function (){

                //resgatar o conteudo dos campos do formulário..
                //objeto
                var model = {

                    //atributos
                    Nome: $("#nome").val(),
                    Preco: $("#preco").val(),
                    Quantidade: $("#quanditdade").val(),
                    IdEstoque: $("#estoque").val()

                };

                //imprimir o objetivo
                console.log(model);

                //função Ajax para consultar os estoque
                $.ajax({});

                //função AJAX (requisição ao servidor)
                $.ajax({

                    type: "POST", //requisição POST
                    url: "/Produto/CadastrarProduto", //endereço
                    data: model, //dados JSON enviados
                    success: function (msg) { //resultado de sucesso
                        console.log(msg);

                        //exibir a mensagem na label
                        $("#mensagem").html(msg);
                        //limpar os campos
                        $(".form-control").val("");
                    },
                    error: function (e) { //falha
                        console.log("Erro ao cadastrar produto: " + e.status);
                    }

                });


            });


        });

    </script>
</head>
<body class="container">
    <div class="row">
        <div class="col-md-12">
            <h2>Cadastro de Produtos</h2>
            <a href="/Home/Index">Voltar</a>
            <hr />
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <label>Nome do Produto:</label>
            <input type="text" id="nome" class="form-control"
                   placeholder="Digite aqui" />
            <br />
            <label>Preço:</label>
            <input type="text" id="preco" class="form-control"
                   placeholder="Digite aqui" />
            <br />
            <label>Quantidade:</label>
            <input type="number" id="quantidade" class="form-control"
                   placeholder="Digite aqui" />
            <br />
            <label>Selecione o Estoque:</label>
            <select id="estoque" class="form-control"></select>
            <br />
            <button id="btncadastro" class="btn btn-success">
                Cadastrar Produto
            </button>
            <br />
            <br />
            <label id="mensagem"></label>
        </div>
    </div>


</body>
</html>
